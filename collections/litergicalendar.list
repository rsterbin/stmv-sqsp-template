{.var @firstDate items.0.startDate}

<div class="row column subtitle">
    <h3>Monthly Worship Schedule: {@firstDate|date %B %Y}</h3>
</div>

<div class="row liturgical-calendar-nav">
    <div class="small-4 large-5 columns prev">
        <a href="#" title="Previous Month"><i class="fa fa-chevron-left"></i></a>
    </div>
    <div class="small-4 large-2 columns current">{@firstDate|date %B %Y}</div>
    <div class="small-4 large-5 columns next">
        <a href="#" title="Next Month"><i class="fa fa-chevron-right"></i></a>
    </div>
</div>

<div id="calendarbox"></div>

<div class="row column raw-services" id="services">
{.repeated section items}
    <div class="raw-service">
        <div class="service{.repeated section tags} {@|url-encode|htmlattr}{.end}">
            <div class="date">
                <div class="service-day-ymd">{startDate|date %F}</div>
                <span class="service-day-number badge number">{startDate|date %e}</span>
                <span class="service-day-weekday weekday">{startDate|date %A}</span>
            </div>
            <div class="title"><a href="{fullUrl|htmlattr}">{title|htmltag}</a></div>
            <div class="excerpt">
                {body}
            </div>
        </div>
    </div>
{.end}
</div>

<script type="text/javascript">
$(document).ready(function (){
    var mday_tpl = '<div class="row">' +
        '    <div class="large-8 large-centered columns">' +
        '        <div class="lcal-month-day">' +
        '            <div class="row">' +
        '                <div class="small-12 medium-2 columns">' +
        '                    <div class="calendar-date">' +
        '                        <span class="badge number"></span>' +
        '                        <span class="weekday"></span>' +
        '                    </div>' +
        '                </div>' +
        '                <div class="small-12 medium-10 columns day-services">' +
        '                </div>' +
        '            </div>' +
        '        </div>' +
        '    </div>' +
        '</div>';

    var found = {};
    $('#services > .raw-service > .service').each(function() {
        var $service = $(this),
            date = $service.find('.service-day-ymd').text(),
            number = $service.find('.service-day-number').text(),
            weekday = $service.find('.service-day-weekday').text();
        if (!(date in found)) {
            var $calday = $(mday_tpl);
            $calday.attr('id', 'calday_' + date);
            $calday.find('.number').text(number);
            $calday.find('.weekday').text(weekday);
            $('#calendarbox').prepend($calday);
            found[date] = true;
        }
        var $block = $('#calendarbox #calday_' + date + ' .day-services');
        console.log($block);
        console.log($service);
        $block.prepend($service.clone());
        $service.closest('.raw-service').remove();
    });

    var months = [ 'january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december' ];
    var x = parseInt('{@firstDate|date %e}') - 1;
    var y = parseInt('{@firstDate|date %Y}');
    if (x - 1 < 1) {
        var prev = '/litergical-calendar/?month=' + months[11] + '-' + (y - 1) + '&view=calendar';
    } else {
        var prev = '/litergical-calendar/?month=' + months[x - 1] + '-' + y + '&view=calendar';
    }
    if (x + 1 > 11) {
        var next = '/litergical-calendar/?month=' + months[0] + '-' + (y + 1) + '&view=calendar';
    } else {
        var next = '/litergical-calendar/?month=' + months[x + 1] + '-' + y + '&view=calendar';
    }
    $('.liturgical-calendar-nav .prev a').attr('href', prev);
    $('.liturgical-calendar-nav .next a').attr('href', next);

});
</script>

<div class="success callout" data-closable>
    <pre style="color: blue;">console.log({@|json-pretty})</pre>
    <button class="close-button" aria-label="Dismiss alert" type="button" data-close>
        <span aria-hidden="true">&times;</span>
    </button>
</div>

