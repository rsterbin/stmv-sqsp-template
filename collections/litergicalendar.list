{.var @firstDate items.0.startDate}

<div><pre style="color: blue;">console.log({@|json-pretty})</pre></div>

<div class="row column subtitle">
    <h3>Monthly Worship Schedule: {@firstDate|date %B %Y}</h3>
</div>

<div class="row calendar-nav">
    <div class="small-4 large-5 columns prev">
        <a href="{pagination.prevPageUrl|htmlattr}" title="Previous Month"><i class="fa fa-chevron-left"></i></a>
    </div>
    <div class="small-4 large-2 columns current">{@firstDate|date %B %Y}</div>
    <div class="small-4 large-5 columns next">
        <a href="{pagination.prevPageUrl|htmlattr}" title="Next Month"><i class="fa fa-chevron-right"></i></a>
    </div>
</div>

<div id="calendarbox"></div>

<div class="row column" id="services">
{.repeated section items}
    <div class="service{.repeated section tags} {@|url-encode|htmlattr}{.end}">
        <div class="service-day-ymd">{startDate|date %F}</div>
        <div class="service-day-number">{startDate|date %e}</div>
        <div class="service-day-weekday">{startDate|date %A}</div>
        <div class="title"><a href="{fullUrl|htmlattr}">{title|htmltag}</a></div>
        <div class="excerpt">
            {body}
        </div>
    </div>
{.end}
</div>

<script type="text/javascript">
$(document).ready(function (){
    var mday_tpl = '<div class="row">' +
        '    <div class="large-8 large-centered columns">' +
        '        <div class="lcal-month-day">' +
        '            <div class="row">' +
        '                <div class="small-12 medium-2 columns">' +
        '                    <div class="calendar-date">' +
        '                        <span class="badge number"></span>' +
        '                        <span class="weekday"></span>' +
        '                    </div>' +
        '                </div>' +
        '                <div class="small-12 medium-10 columns day-services">' +
        '                </div>' +
        '            </div>' +
        '        </div>' +
        '    </div>' +
        '</div>';
    var found = {};
    $('#services > .service').each(function() {
        var $service = $(this),
            date = $service.find('.service-day-ymd').text(),
            number = $service.find('.service-day-number').text(),
            weekday = $service.find('.service-day-weekday').text();
        if (!(date) in found) {
            var $calday = $(mday_tpl);
            $calday.attr('id', 'calday_' + date);
            $calday.find('.number').text(number);
            $calday.find('.weekday').text(weekday);
            $('#calendarbox').prepend($calday);
        }
        var $block = $('#calendarbox #calday_' + date + ' .day-services');
        $block.prepend($service);
        // $service.remove();
    });
});
</script>

